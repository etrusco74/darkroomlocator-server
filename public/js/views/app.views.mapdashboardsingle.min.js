app.views.mapdashboardsingle=Backbone.View.extend({initialize:function(){console.log("initializing mapdashboardsingle view")},render:function(){$(this.el).html(this.template());$(document).attr("title","darkroom locator - find and share darkrooms | "+this.language.type+" | "+this.language.lang);return this},resize_map:function(){var e=$("#map_canvas_div").width();this.$el.find("#map_canvas").height(250);this.$el.find("#map_canvas").width(e)},init_map:function(e){var t=this;t.resize_map();$.getJSON(app.const.apiurl()+"report/id/"+e,this.refreshMapUI);$("#slider_div").hide();t.renderImagesCollectionToUl(e)},refreshMapUI:function(e){var t=app.views.mapdashboardsingle.prototype;moment.lang(t.language.lang);var n=moment(e.report_date).fromNow();var r=t.language.bitly_login,i=t.language.bitly_apikey,s=t.language.bitly_long_url+e._id;t.get_short_url(s,r,i,function(r){var i=[];i=e.keywords;var s="",o;for(o=0;o<i.length;o++){s+='<span class="label label-info">'+i[o]+"</span> "}var u="";switch(t.language.lang){case"it":u=e.type_id.description_it;break;case"en":u=e.type_id.description_en;break;case"de":u=e.type_id.description_de;break;case"es":u=e.type_id.description_es;break;case"fr":u=e.type_id.description_fr;break;default:u=e.type_id.description_en;break}var a=t.language.html_header_panel_right;var f=t.language.html_header_panel_bottom;var l="<p>"+t.language.html_user+" : <span class='label label-success'>"+e.username+"</span><br />"+t.language.html_type+" : <span class='text-primary'>"+u+"</span><br />"+t.language.html_location+" : <span class='text-muted'>"+e.region+" ("+e.province+")</span><br />"+t.language.html_description+" : <span class='text-danger'>"+e.description+"</span><br />"+t.language.html_note+" : <span class='text-success'>"+e.note+"</span></p>";var c="<p>"+s+"<br /><br />"+t.language.html_date+" : <span class='text-danger'>"+n+"</span>";if(typeof e.website!=="undefined"&&e.website!=""){c+="<br />"+t.language.html_website_pre+" <a href='"+e.website+"' target='_blank'>"+t.language.html_website_in+"</a>"}if(typeof e.contact_email!=="undefined"&&e.contact_email!=""){c+="<br />"+t.language.html_email_pre+" <a href='mailto:"+e.contact_email+"'>"+t.language.html_email_in+"</a>"}c+="<br /> <b>permalink</b> <input type='text' value='"+r+"' onClick='this.focus();this.select();' />"+" </p>";$("#map_sidebar_single_header_right").html(a);$("#map_sidebar_single_header_bottom").html(f);$("#map_sidebar_single_content_right").html(l);$("#map_sidebar_single_content_bottom").html(c);var h=new google.maps.LatLng(e.lat,e.lng);var p={zoom:12,center:h,mapTypeId:google.maps.MapTypeId.ROADMAP};app.global.map=new google.maps.Map($("#map_canvas").get(0),p);var d=new google.maps.Marker({position:h,icon:"css/img/"+e.type_id.value+".png",title:u});d.setMap(app.global.map)})},get_short_url:function(e,t,n,r){$.getJSON("http://api.bitly.com/v3/shorten?callback=?",{format:"json",apiKey:n,login:t,longUrl:e},function(e){r(e.data.url)})},renderImagesCollectionToUl:function(e){var t=this;var n=new app.collections.images;n.fetch({success:function(){console.log(n.models);$("#slider").empty();var e=n.models[0].get("data").resources;if(e.length>0)$("#slider_div").show();e.forEach(function(e){console.log(e);$("#slider").append('<li><img src="'+e.url+'"></li>')});$("#slider").responsiveSlides({maxwidth:350,speed:800})},error:function(e,n){bootbox.dialog({title:t.language.error_message,message:t.language.error_message,buttons:{main:{label:t.language.label_button,className:"btn btn-danger",callback:function(){$("body").removeClass("modal-open")}}}})},url:app.const.apiurl()+"images/dir/"+e})},destroy_view:function(){this.undelegateEvents();$(this.el).removeData().unbind();this.remove();Backbone.View.prototype.remove.call(this);app.global.mapdashboardsingleView=null}})