app.views.password=Backbone.View.extend({initialize:function(){console.log("initializing password view")},events:{submit:"password_update"},render:function(){$(this.el).html(this.template());this.$("#passwordForm").validate({rules:{password:{required:true,maxlength:12},repassword:{required:true,maxlength:12,equalTo:"#password"}},messages:this.language.form_messages});this.password_modelToForm();return this},password_update:function(e){e.preventDefault();var t=this;bootbox.dialog({title:t.language.header_confirm_upd_message,message:t.language.body_confirm_upd_message,buttons:{confirm:{label:t.language.confirm_button,className:"btn btn-success",callback:function(){$("body").removeClass("modal-open");t.password_confirm_update()}},cancel:{label:t.language.cancel_button,className:"btn btn-info"}}})},password_confirm_update:function(){var e=this;var t=this.password_formToJson();var n=new app.models.user;n.save(t,{success:function(t){if(t.changed.success){app.global.tokensCollection.each(function(e){e.destroy()});var n=new app.models.token(t.get("user"));app.global.tokensCollection.add(n);n.save();bootbox.dialog({title:e.language.header_success_upd_message,message:e.language.body_success_upd_message,buttons:{main:{label:e.language.label_button,className:"btn btn-info",callback:function(){$("body").removeClass("modal-open")}}}})}else{bootbox.dialog({title:e.language.error_message,message:e.language.error_message+" : "+t.changed.error,buttons:{main:{label:e.language.label_button,className:"btn btn-danger",callback:function(){$("body").removeClass("modal-open")}}}})}console.log(t);console.log(t.changed)},error:function(t){bootbox.dialog({title:e.language.error_message,message:e.language.error_message,buttons:{main:{label:e.language.label_button,className:"btn btn-danger",callback:function(){$("body").removeClass("modal-open")}}}});console.log(t)},url:app.const.apiurl()+"user/id/"+t.id,"private":true})},password_formToJson:function(){var e={};e.id=this.$("#_id").val();e.username=this.$("#username").val();e.password=this.$("#password").val();return e},password_modelToForm:function(){var e=this;var t=new app.models.user;t.fetch({success:function(t){if(typeof t.get("_id")!=="undefined"){e.$("#_id").val(t.get("_id"));e.$("#username").val(t.get("username"));console.log(t)}else{console.log(t);app.routers.router.prototype.logout()}},error:function(t){bootbox.dialog({title:e.language.error_message,message:e.language.error_message,buttons:{main:{label:e.language.label_button,className:"btn btn-danger",callback:function(){$("body").removeClass("modal-open")}}}});console.log(t)},url:app.const.apiurl()+"user/id/"+app.global.tokensCollection.first().get("_id"),"private":true})},destroy_view:function(){this.undelegateEvents();$(this.el).removeData().unbind();this.remove();Backbone.View.prototype.remove.call(this);app.global.passwordView=null}})