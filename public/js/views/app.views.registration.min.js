app.views.registration=Backbone.View.extend({initialize:function(){console.log("initializing registration view")},events:{submit:"registration","click #btnRegistrationHome":"registration_home"},registration_home:function(){app.routers.router.prototype.index()},render:function(){$(this.el).html(this.template());$.validator.addMethod("check_username",function(e,t){return this.optional(t)||e.match(/^[a-zA-Z0-9._-]+$/)});$.validator.addMethod("check_password",function(e,t){return this.optional(t)||e.match(/^[a-zA-Z0-9@!$%._-]+$/)});this.$("#registrationForm").validate({rules:{first_name:"required",last_name:"required",username:{required:true,check_username:true,maxlength:20,minlength:3},password:{required:true,check_password:true,maxlength:12,minlength:4},repassword:{required:true,maxlength:12,equalTo:"#password"},email:{required:true,email:true},agree:"required"},messages:this.language.form_messages});return this},registration:function(e){e.preventDefault();var t=this;var n=this.registration_formToJson();var r=new app.models.user;r.save(n,{success:function(e){if(e.changed.success){bootbox.dialog({title:t.language.header_registration_message,message:t.language.body_registration_message,buttons:{main:{label:t.language.label_button,className:"btn btn-info",callback:function(){$("body").removeClass("modal-open");app.routers.router.prototype.index()}}}})}else{bootbox.dialog({title:t.language.error_message,message:t.language.error_message+" : "+e.changed.error,buttons:{main:{label:t.language.label_button,className:"btn btn-danger",callback:function(){$("body").removeClass("modal-open")}}}})}console.log(e);console.log(e.changed)},error:function(e){bootbox.dialog({title:t.language.error_message,message:t.language.error_message,buttons:{main:{label:t.language.label_button,className:"btn btn-danger",callback:function(){$("body").removeClass("modal-open")}}}});console.log(e)},url:app.const.apiurl()+"user","private":false})},registration_formToJson:function(){var e={};e.first_name=this.$("#first_name").val();e.last_name=this.$("#last_name").val();e.username=this.$("#username").val();e.password=this.$("#password").val();e.email=this.$("#email").val();return e},destroy_view:function(){this.undelegateEvents();$(this.el).removeData().unbind();this.remove();Backbone.View.prototype.remove.call(this);app.global.registrationView=null}})