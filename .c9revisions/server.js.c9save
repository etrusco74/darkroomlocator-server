{"ts":1378564315154,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/** enable to log on nodefly - http://nodefly.com/ **/\r\nrequire('nodefly').profile(\r\n    '673f9f87-b3e1-4d5f-887f-e8a965924ac6',\r\n    ['darkroomlocator', process.env.SUBDOMAIN],\r\n    { blockThreshold: 10 }\r\n);\r\n\r\nvar express = require('express');\r\nvar path = require('path');\r\nvar http = require('http');\r\nvar config = require('./config/config');\r\nvar api = require('./api/api');\r\nvar appRoute = require('./routes/app');\r\n\r\nvar app = express();\r\n\r\n/** app config **/\r\napp.configure(function () {\r\n    app.use(express.logger('dev'));  /* 'default', 'short', 'tiny', 'dev' */\r\n    app.use(express.compress()),\r\n    app.use(express.methodOverride()),\r\n    app.use(express.bodyParser()),\r\n    app.use(express.static(path.join(__dirname, '/public')));\r\n    app.engine('.html', require('ejs').__express);\r\n    app.set('port', config.web.port);\r\n    app.set('views', __dirname + '/views');\r\n    app.set('view engine', 'html');\r\n});\r\n\r\napp.configure('development', function(){\r\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true }));\r\n});\r\n\r\napp.configure('production', function(){\r\n  app.use(express.errorHandler());\r\n});\r\n\r\nconsole.log(app.get('env'));\r\n\r\n/** cross domain request **/\r\napp.all('*', function(req, res, next){\r\n  if (!req.get('Origin')) return next();\r\n  res.set('Access-Control-Allow-Origin', '*');\r\n  res.set('Access-Control-Allow-Methods', 'PUT, GET, POST, DELETE');\r\n  res.set('Access-Control-Allow-Headers', 'X-Requested-With, Content-Type, authkey, username, lang');\r\n  if ('OPTIONS' == req.method) return res.send(200);\r\n  next();\r\n});\r\n\r\n/** app route view **/ \r\napp.get('/', appRoute.under);\r\napp.get('/beta', appRoute.root);\r\n\r\n/** api route - RESTful webservice **/\r\n\r\n/** user api **/\r\napp.get('/api/users', api.findUsers);\r\napp.get('/api/user/id/:id', api.findUserById);\r\napp.get('/api/user/username/:username', api.findUserByUsername);\r\n\r\napp.post('/api/login', api.login);\r\napp.post('/api/user', api.saveUser);\r\n\r\napp.put('/api/user/id/:id', api.updateUserById);\r\napp.put('/api/user/activate/id/:id/key/:key', api.activateUserById);\r\napp.put('/api/user/resetpwd/email/:email', api.resetUserPassword);\r\n\r\napp.delete('/api/users', api.deleteUsers);\r\napp.delete('/api/user/id/:id', api.deleteUserById);\r\n\r\n/** report type api **/\r\napp.get('/api/types', api.findTypes);\r\napp.get('/api/type/id/:id', api.findTypeById);\r\n\r\n/** report api **/\r\napp.get('/api/reports', api.findReports);\r\napp.get('/api/report/id/:id', api.findReportById);\r\napp.get('/api/reports/username/:username', api.findReportsByUsername);\r\napp.get('/api/reports/geo/:lat/:lng/:km', api.findReportsByGeo);\r\napp.get('/api/reports/text/:text', api.findReportsByText);\r\napp.get('/api/reports/params/:lat/:lng/:km/:text/:id', api.findReportsByParams);\r\n\r\napp.post('/api/report', api.saveReport);\r\n\r\napp.put('/api/report/id/:id', api.updateReportById);\r\n\r\napp.delete('/api/report/id/:id', api.deleteReportById);\r\n\r\n\r\n/** 404 error **/\r\napp.all('*', function(req, res){\r\n  res.send('mmmmhhh!!! ... ', 404);\r\n});\r\n\r\nhttp.createServer(app).listen(app.get('port'), function () {\r\n    console.log(\"Express server started and listening on port \" + app.get('port'));\r\n});"]],"start1":0,"start2":0,"length1":0,"length2":3166}]],"length":3166}
{"ts":1378565260634,"patch":[[{"diffs":[[0,"m/ **/\r\n"],[1,"/*\r\n"],[0,"require("]],"start1":48,"start2":48,"length1":16,"length2":20},{"diffs":[[0,"0 }\r\n);\r"],[1,"\n*/\r"],[0,"\n\r\nvar e"]],"start1":206,"start2":206,"length1":16,"length2":20}]],"length":3174,"saved":false}
{"ts":1378565460898,"patch":[[{"diffs":[[0,"*/\r\n"],[-1,"/*\r\n"],[0,"requ"]],"start1":52,"start2":52,"length1":12,"length2":8},{"diffs":[[0,"\n);\r"],[-1,"\n*/\r"],[0,"\n\r\nv"]],"start1":206,"start2":206,"length1":12,"length2":8}]],"length":3166,"saved":false}
{"ts":1378565661582,"patch":[[{"diffs":[[0,"m/ **/\r\n"],[1,"/*\r\n"],[0,"require("]],"start1":48,"start2":48,"length1":16,"length2":20},{"diffs":[[0,"0 }\r\n);\r"],[1,"\n*/\r"],[0,"\n\r\nvar e"]],"start1":206,"start2":206,"length1":16,"length2":20}]],"length":3174,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378719461643,"patch":[[{"diffs":[[0,"*/\r\n"],[-1,"/*\r\n"],[0,"requ"]],"start1":52,"start2":52,"length1":12,"length2":8},{"diffs":[[0," }\r\n);\r\n"],[-1,"*/"],[0,"\r\n\r\nvar "]],"start1":203,"start2":203,"length1":18,"length2":16}]],"length":3168,"saved":false}
{"ts":1378719620970,"patch":[[{"diffs":[[-1,"/** enable to log on nodefly - http://nodefly.com/ **/\r\nrequire('nodefly').profile(\r\n    '673f9f87-b3e1-4d5f-887f-e8a965924ac6',\r\n    ['darkroomlocator', process.env.SUBDOMAIN],\r\n    { blockThreshold: 10 }\r\n);\r\n\r\n\r\n"],[0,"var "]],"start1":0,"start2":0,"length1":219,"length2":4},{"diffs":[[0,"press();\r\n\r\n"],[1,"/*\r\n/** enable to log on nodefly - http://nodefly.com/ **/\r\nrequire('nodefly').profile(\r\n    '673f9f87-b3e1-4d5f-887f-e8a965924ac6',\r\n    ['darkroomlocator', process.env.SUBDOMAIN],\r\n    { blockThreshold: 10 }\r\n);\r\n*/\r\n\r\n"],[0,"/** app conf"]],"start1":223,"start2":223,"length1":24,"length2":245}]],"length":3174,"saved":false}
{"ts":1378719632980,"patch":[[{"diffs":[[0,"/*\r\n"],[-1,"/** enable to log on nodefly - http://nodefly.com/ **/\r\n"],[0,"requ"]],"start1":235,"start2":235,"length1":64,"length2":8}]],"length":3118,"saved":false}
{"contributors":[],"silentsave":false,"ts":1380292085208,"patch":[[{"diffs":[[0,"ute."],[-1,"under"],[1,"root"],[0,");\r\n"]],"start1":1570,"start2":1570,"length1":13,"length2":12},{"diffs":[[0,"', appRoute."],[-1,"root"],[1,"under"],[0,");\r\n\r\n/** ap"]],"start1":1596,"start2":1596,"length1":28,"length2":29}]],"length":3118,"saved":false}
